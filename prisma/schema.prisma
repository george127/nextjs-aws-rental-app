generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String         @id @default(uuid())
  email             String         @unique
  phone             String?       
  name              String?
  password          String
  role              Role
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  managedProperties Property[]     @relation("ManagerProperties")
  tenantProfile     TenantProfile?
}


model Property {
  id           String   @id @default(uuid())
  name         String   // Property name
  address      String   // Full address
  
  // Price information
  rentAmount   Float    // Monthly rent
  securityDeposit Float // Security deposit
  
  // Property details
  bedrooms     Int
  bathrooms    Int
  squareFeet   Int?
  description  String?  // Detailed description
  
  // Status & type
  propertyType String   // "apartment", "house", "condo"
  status       String   @default("vacant") // "occupied", "vacant", "maintenance"
  
  // Manager/Owner
  managerId    String
  manager      User     @relation("ManagerProperties", fields: [managerId], references: [id])
  
  imageData           String?              // Base64 encoded image (for testing only)
  imageUrl            String?              // For future S3 URL

  // Location details
  city         String
  state        String
  zipCode      String
  
  // Amenities
  amenities    String[] // ["parking", "pool", "gym", "washer/dryer"]
  
  // Timestamps
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  tenants      TenantProfile[]
  maintenanceRequests MaintenanceRequest[]
}

model TenantProfile {
  id                  String               @id @default(uuid())
  userId              String               @unique
  propertyId          String
  rentAmount          Decimal
  rentDueDay          Int
  createdAt           DateTime             @default(now())
  maintenanceRequests MaintenanceRequest[]
  payments            Payment[]
  property            Property             @relation(fields: [propertyId], references: [id])
  user                User                 @relation(fields: [userId], references: [id])
}

model Payment {
  id        String        @id @default(uuid())
  tenantId  String
  amount    Decimal
  status    PaymentStatus
  reference String        @unique
  paidAt    DateTime?
  createdAt DateTime      @default(now())
  tenant    TenantProfile @relation(fields: [tenantId], references: [id])
}

model MaintenanceRequest {
  id          String            @id @default(uuid())
  tenantId    String
  propertyId  String
  title       String
  description String
  status      MaintenanceStatus @default(OPEN)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  files       File[]
  property    Property          @relation(fields: [propertyId], references: [id])
  tenant      TenantProfile     @relation(fields: [tenantId], references: [id])
}

model File {
  id                 String              @id @default(uuid())
  url                String
  key                String
  uploadedAt         DateTime            @default(now())
  requestId          String?
  maintenanceRequest MaintenanceRequest? @relation(fields: [requestId], references: [id])
}

enum Role {
  TENANT
  MANAGER
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum MaintenanceStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
}